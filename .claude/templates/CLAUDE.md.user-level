# Agentic Substrate v4.1 - System-Wide Enhancement

**The Love of Wisdom (Philia Sophia) - Research-Driven Development**

This file documents the Agentic Substrate capabilities installed system-wide in `~/.claude/`. These enhancements work across **all projects** and integrate seamlessly with project-specific configurations.

---

## üöÄ Quick Start

```bash
# Universal command - just say what you want (RECOMMENDED)
/do add authentication to my API
/do why is this function slow?
/do deploy to production

# Complete automation
/workflow Add Redis caching to ProductService with 5-minute TTL

# Step-by-step control
/research Redis for Node.js v5.0
/plan Redis caching implementation
/implement

# Direct agent invocation
@chief-architect Build complete authentication system
```

---

## üì¶ What's Installed

### 9 Agents (Complete BUILD-FIX-SERVE Coverage)

**Tier 1: Orchestrator (1 agent)**
- **@chief-architect** - Master orchestrator for complex multi-agent workflows

**Tier 2: Core Workflow (5 agents)** - BUILD + FIX phases
- **@docs-researcher** - Fetches version-accurate docs (< 2 min, 49-67% better accuracy)
- **@implementation-planner** - Creates minimal-change blueprints with rollback plans
- **@brahma-analyzer** - Cross-artifact consistency validation (quality gate: 80+ score)
- **@code-implementer** - Executes with TDD, self-corrects 3x, auto-commits to git
- **@brahma-investigator** - Systematic root-cause debugging (3-retry think protocol)

**Tier 3: Production (3 agents)** - SERVE phase
- **@brahma-deployer** - Canary deployments (5%‚Üí25%‚Üí50%‚Üí100%) with auto-rollback
- **@brahma-monitor** - Observability: Metrics, Logs, Traces (three pillars)
- **@brahma-optimizer** - Performance profiling, optimization, auto-scaling

### 5 Skills (Auto-invoked capabilities)
- **research-methodology** - Truth over speed (but achieve both)
- **planning-methodology** - Surgical changes, not rewrites
- **quality-validation** - Objective scoring (blocks bad inputs)
- **pattern-recognition** - Automatic learning from implementations
- **context-engineering** - Fights context rot (39% improvement, 84% token reduction)

### 7 Commands (Slash commands)
- **/do [anything]** - Universal command router (RECOMMENDED) - analyzes intent and routes to best approach
- **/workflow [feature]** - Complete automation (research ‚Üí plan ‚Üí implement)
- **/research [topic]** - Fast documentation research
- **/plan [feature]** - Create implementation plan
- **/implement** - Execute plan with TDD
- **/context [analyze|optimize|reset]** - Manage context health
- **/circuit-breaker [status|reset]** - View/manage implementation circuit breaker

### 8 Hooks (Quality gates)
- **Pre-agent-spawn** - Economic viability check (15x cost warning)
- **Post-tool-use** - Context curation suggestions
- **Pre-commit** - Safety checks (no secrets, binaries)
- **Post-test** - Coverage analysis
- **4 others** - Additional quality enforcement

---

## üß† Extended Thinking Modes

Include keywords in your request to trigger extended reasoning:

| Keyword | Time | Use For | Performance |
|---------|------|---------|-------------|
| **think** | 30-60s | Routine planning, standard decisions | Baseline |
| **think hard** | 1-2min | Multiple valid approaches, unclear tradeoffs | +30% |
| **think harder** | 2-4min | Novel problems, high-stakes decisions | +54% |
| **ultrathink** | 5-10min | Critical architecture, multi-agent coordination | +54% |

**Research finding**: 54% improvement on complex tasks (Anthropic)

**Example**: `ultrathink the architecture for multi-tenant auth before planning`

---

## ‚öôÔ∏è Core Workflow

### Research ‚Üí Plan ‚Üí Implement (10-25 minutes total)

**Phase 1: Research** (< 2 min)
- Fetches official, version-accurate documentation
- Prevents coding from stale memory
- Creates ResearchPack (must score 80+)

**Phase 2: Planning** (< 3 min)
- Transforms research into minimal-change blueprint
- Identifies surgical edits only (no rewrites)
- Includes rollback procedure (must score 85+)

**Phase 3: Implementation** (< 5 min)
- Test-first mandatory (RED-GREEN-REFACTOR)
- Self-corrects on error (max 3 attempts)
- Auto-commits with co-author attribution

### Quality Gates (Automatic)

**Gate 1: Research ‚Üí Planning**
- ‚úÖ ResearchPack score ‚â• 80 (API) or ‚â• 70 (philosophy)
- ‚õî Blocks planning if research incomplete

**Gate 2: Planning ‚Üí Implementation**
- ‚úÖ Implementation Plan score ‚â• 85
- ‚úÖ APIs match ResearchPack exactly (no hallucination)
- ‚õî Blocks coding if plan unsafe

**Gate 3: Implementation ‚Üí Completion**
- ‚úÖ All tests passing (TDD enforced)
- ‚úÖ Circuit breaker closed
- ‚õî Self-corrects 3x, then stops

---

## üéØ When to Use What

### Use `/do` when (RECOMMENDED):
- ‚úÖ You want Claude to figure out the best approach
- ‚úÖ You're not sure which command to use
- ‚úÖ You want intelligent intent detection
- ‚úÖ Any task - it routes automatically to the right tool

### Use `/workflow` when:
- ‚úÖ Clear, well-defined feature request
- ‚úÖ Trust orchestrator to handle details
- ‚úÖ Want complete automation (research ‚Üí plan ‚Üí implement)
- ‚úÖ Standard feature (not experimental)

### Use manual commands when:
- Need to review research before planning (`/research` then inspect)
- Want to modify plan before implementing (`/plan` then edit)
- Uncertain about approach (step-by-step control)
- Learning the system

### Use direct agents when:
- Complex orchestration needed (`@chief-architect`)
- Just need research (`@docs-researcher`)
- Have research, need plan (`@implementation-planner`)
- Have plan, ready to code (`@code-implementer`)

---

## üìä Performance Benchmarks

From Anthropic research and Agentic Substrate testing:

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| **Complex task accuracy** | Baseline | +54% | Think tool |
| **Research accuracy** | Baseline | +49-67% | Contextual retrieval |
| **Context optimization** | Baseline | +39%, -84% tokens | Active curation |
| **Multi-agent performance** | Baseline | +90.2%, -90% time | Parallel execution |
| **Feature implementation** | 55-120 min | 10-25 min | 4.8-5.5x faster |
| **Test coverage** | Variable | 80%+ | TDD enforced |
| **API hallucination** | Common | 0% | ResearchPack validation |

---

## üîÑ Context Management

Run every 50 messages or when switching tasks:

```bash
/context analyze    # Show current context configuration
/context optimize   # Prune stale context automatically
/context reset      # Fresh start for new project
```

**Benefits**: 39% improvement, 84% token reduction (Anthropic research)

---

## üõ°Ô∏è Safety Features

### Circuit Breaker
- Opens after 3 failed implementation attempts
- Prevents infinite retry loops
- Requires manual intervention to reset
- Check status: `/circuit-breaker status`
- Reset: `/circuit-breaker reset`
- Manual: `echo "closed" > ~/.claude/.circuit-breaker-state`

### Economic Viability Check
- Multi-agent spawning costs 15x more tokens
- Hook prompts user before spawning multiple agents
- Blocks simple tasks (use single agent)
- Allows complex tasks (worth the cost)

### Git Safety
- Never commits .env, credentials, or binaries
- Stages only relevant files
- Creates descriptive commit messages
- Co-author attribution to Claude
- Commits locally only (user must push)

---

## üß© Integration with Project Brahma

If you have the Unified Brahma Orchestration System V2.0 installed:

**Agentic Substrate** (4 agents - Research ‚Üí Plan ‚Üí Implement):
- System-wide workflow automation
- Works in ANY directory
- Quality gates and TDD enforcement

**Project Brahma** (18 agents - BUILD ‚Üí FIX ‚Üí SERVE):
- Multi-project orchestration
- Constitution-driven workflows
- Production deployment automation

**They work together**:
```bash
# Agentic Substrate handles feature development
/workflow Add payment processing with Stripe

# Project Brahma handles deployment
@brahma-deployer v2.5.0 to production with canary
```

See `/Users/amba/CLAUDE.md` for complete Brahma documentation.

---

## üìö Memory Hierarchy

Claude Code loads context in this order:

```
1. Enterprise: /Library/Application Support/ClaudeCode/CLAUDE.md
2. User: ~/.claude/CLAUDE.md (THIS FILE)
3. Project: ./CLAUDE.md or ./.claude/CLAUDE.md
4. Imports: @path/to/file.md (up to 5 hops)
```

**They combine** - they don't override. Use this hierarchy:

- **User-level** (this file): System-wide capabilities
- **Project-level** (./CLAUDE.md): Project-specific goals, constitution, workflows
- **Imports** (@.claude/templates/*.md): Modular organization

---

## üìñ Quick Reference

### Agents
@.claude/templates/agents-overview.md

### Skills
@.claude/templates/skills-overview.md

### Workflows
@.claude/templates/workflows-overview.md

---

## üéì Best Practices

1. **Start with `/do`** - Let Claude figure out the best approach
2. **Use `/workflow` for features** - Full automation is faster and safer
3. **Trust the quality gates** - Fix defects before proceeding
4. **Use think protocols** - Add "ultrathink" for critical decisions
5. **Run `/context optimize`** - Every 50 messages
6. **Review knowledge-core.md** - See accumulated patterns
7. **Test before pushing** - Git commits are local only

---

## üîç Troubleshooting

**Problem**: Research scores < 80
- **Solution**: Library version not found - specify version explicitly

**Problem**: Plan scores < 85
- **Solution**: Missing rollback procedure or file list incomplete

**Problem**: Tests failing after implementation
- **Solution**: Self-correction runs automatically (max 3 attempts)

**Problem**: Circuit breaker open
- **Solution**: Run `/circuit-breaker reset` or `echo "closed" > ~/.claude/.circuit-breaker-state`

**Problem**: Too much context
- **Solution**: Run `/context optimize` to prune stale information

---

## üì¶ Installation Info

- **Version**: 4.1.0
- **Installed**: ~/.claude/
- **Repository**: https://github.com/VAMFI/claude-user-memory
- **Documentation**: https://vamfi.org/blog-demo8-philia-sophia

### v4.1 Enhancements
- **`/do` command** - Universal intent-based router (just say what you want)
- **`/circuit-breaker` command** - Direct circuit breaker management
- **DeepWiki MCP** - Mandatory for all agents (reduces API hallucination to <2%)
- **Agent optimization** - 20-30% token reduction in prompts

### Update
```bash
cd ~/path/to/claude-user-memory
git pull origin main
./install.sh
```

### Uninstall
```bash
rm -rf ~/.claude/agents/{chief-architect,docs-researcher,implementation-planner,code-implementer,brahma-*}.md
rm -rf ~/.claude/skills/{research-methodology,planning-methodology,quality-validation,pattern-recognition,context-engineering}
rm -rf ~/.claude/commands/{do,research,plan,implement,workflow,context,circuit-breaker}.md
# Review and manually remove hooks if needed
```

---

## üåü Philosophy: Philia Sophia

**The Love of Wisdom** - Synthesis over imitation.

This system combines:
- **Anthropic's research** (think tool, contextual retrieval, multi-agent orchestration)
- **VAMFI's innovations** (quality gates, TDD enforcement, knowledge preservation)

Result: **Research-driven development** that's faster, safer, and continuously learning.

---

**For detailed workflows, see templates above. For Project Brahma integration, see /Users/amba/CLAUDE.md**

**Happy coding with superintelligent assistance!**
